package com.github.lernejo.korekto.toolkit.thirdparty.pmd

import com.github.lernejo.korekto.toolkit.thirdparty.pmd.rules.FieldMandatoryModifiersRule
import org.assertj.core.api.Assertions.assertThat
import org.junit.jupiter.api.Test

internal class RuleSetGeneratorTest {
    @Test
    internal fun `ruleSet is properly generated`() {
        val ruleSet = RuleSetGenerator().generateRuleSet(
            Rule(
                "category/java/design.xml/ExcessiveClassLength",
                "Class has \'{0}\' lines, exceeding the maximum of 10",
                mapOf("minimum" to 100)
            ),
            Rule(
                "category/java/design.xml/ExcessiveMethodLengthRule",
                "Method has \'{0}\' lines, exceeding the maximum of 10",
                mapOf("minimum" to 12)
            ),
            Rule(FieldMandatoryModifiersRule::class.java)
        )

        assertThat(ruleSet).isEqualTo(
            """
            <?xml version="1.0"?>
            <ruleset xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                     name="Custom Rules"
                     xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
                     xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 https://pmd.sourceforge.io/ruleset_2_0_0.xsd">

                <description>
                    Generated by Korekto
                </description>

                <rule ref="category/java/design.xml/ExcessiveClassLength" message="Class has &apos;{0}&apos; lines, exceeding the maximum of 10">
                    <properties>
                        <property name="minimum" value="100"/>
                    </properties>
                </rule>

                <rule ref="category/java/design.xml/ExcessiveMethodLengthRule" message="Method has &apos;{0}&apos; lines, exceeding the maximum of 10">
                    <properties>
                        <property name="minimum" value="12"/>
                    </properties>
                </rule>

                <rule class="com.github.lernejo.korekto.toolkit.thirdparty.pmd.rules.FieldMandatoryModifiersRule" name="FieldMandatoryModifiersRule" language="java">
                    
                </rule>
            </ruleset>
            
        """.trimIndent()
        )
    }
}
